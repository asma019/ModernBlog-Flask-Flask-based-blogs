{% extends "base.html" %}

{% block title %}{{ post.title }} - {{ site_name or 'ModernBlog' }}{% endblock %}
{% block description %}{{ post.excerpt or post.content[:160] }}{% endblock %}
{% block keywords %}{{ post.tags|map(attribute='name')|join(', ') }}{% endblock %}

{% block og_title %}{{ post.title }}{% endblock %}
{% block og_description %}{{ post.excerpt or post.content[:160] }}{% endblock %}
{% block og_type %}article{% endblock %}
{% block og_image %}
{% if post.cover_image %}
<meta property="og:image" content="{{ url_for('static', filename='uploads/' + post.cover_image, _external=True) }}">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
{% endif %}
{% endblock %}

{% block twitter_image %}
{% if post.cover_image %}
<meta name="twitter:image" content="{{ url_for('static', filename='uploads/' + post.cover_image, _external=True) }}">
{% endif %}
{% endblock %}

{% block content %}
<!-- Top Banner Ad -->
{% if ads_header %}
<div class="mx-auto max-w-4xl px-4 py-4 text-center">
<div class="bg-gray-800/50 border border-gray-700/50 rounded-lg p-4 overflow-hidden dark:bg-gray-800/50 light:bg-gray-100/50 light:border-gray-300/50">
{{ ads_header|safe }}
</div>
</div>
{% endif %}

<article class="mx-auto max-w-4xl px-4 py-6 sm:py-8 dark:bg-gray-900 dark:text-white light:bg-white light:text-gray-900 transition-colors duration-300">
    <!-- Breadcrumb -->
    <nav class="mb-8">
        <ol class="flex items-center space-x-2 text-sm dark:text-gray-400 light:text-gray-600">
            <li><a href="{{ url_for('index') }}" class="hover:text-blue-400 transition-colors">Home</a></li>
            <li><span class="material-symbols-outlined text-xs">chevron_right</span></li>
            {% if post.category %}
            <li><a href="{{ url_for('category_posts', slug=post.category.slug) }}" class="hover:text-blue-400 transition-colors">{{ post.category.name }}</a></li>
            <li><span class="material-symbols-outlined text-xs">chevron_right</span></li>
            {% endif %}
            <li class="dark:text-white light:text-gray-900">{{ post.title }}</li>
        </ol>
    </nav>

    <!-- Cover Image -->
    {% if post.cover_image %}
    <div class="mb-6 sm:mb-8 rounded-xl overflow-hidden shadow-2xl relative">
        <img src="{{ url_for('static', filename='uploads/' + post.cover_image) }}" 
             alt="{{ post.title }}" 
             class="w-full h-48 sm:h-64 md:h-80 lg:h-96 object-cover">
        <div class="absolute inset-0 bg-gradient-to-t from-gray-900/20 to-transparent"></div>
    </div>
    {% else %}
    <div class="mb-6 sm:mb-8 rounded-xl overflow-hidden shadow-2xl relative h-48 sm:h-64 md:h-80 lg:h-96 bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-700 flex items-center justify-center">
        <div class="text-center">
            <span class="material-symbols-outlined text-6xl sm:text-8xl text-white/80 mb-4">code</span>
            <h2 class="text-xl sm:text-2xl font-bold text-white/90">Programming Article</h2>
        </div>
        <div class="absolute inset-0 bg-gradient-to-t from-gray-900/20 to-transparent"></div>
    </div>
    {% endif %}

    <!-- Post Header -->
    <header class="mb-8">
        {% if post.category %}
        <div class="flex items-center gap-2 mb-4">
            <span class="material-symbols-outlined text-blue-400 text-sm">folder</span>
            <span class="bg-blue-600/20 text-blue-400 text-sm px-3 py-1 rounded-full">
                {{ post.category.name }}
            </span>
        </div>
        {% endif %}
        
        <h1 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold dark:text-white light:text-gray-900 mb-4 leading-tight">{{ post.title }}</h1>
        
        {% if post.excerpt %}
        <p class="text-lg sm:text-xl dark:text-gray-300 light:text-gray-600 mb-4 sm:mb-6">{{ post.excerpt }}</p>
        {% endif %}
        
        <div class="flex flex-wrap items-center gap-4 text-gray-400 mb-4 sm:mb-6 text-sm">
            <div class="flex items-center gap-1">
                <span class="material-symbols-outlined text-sm">calendar_today</span>
                <time datetime="{{ post.created_at.isoformat() }}">{{ post.created_at.strftime('%B %d, %Y') }}</time>
            </div>
            {% if post.updated_at != post.created_at %}
            <div class="flex items-center gap-1">
                <span class="material-symbols-outlined text-sm">edit</span>
                <span>Updated {{ post.updated_at.strftime('%B %d, %Y') }}</span>
            </div>
            {% endif %}
            <div class="flex items-center gap-1">
                <span class="material-symbols-outlined text-sm">schedule</span>
                <span>{{ (post.content|length / 200)|round|int }} min read</span>
            </div>
        </div>
        
        {% if post.tags %}
        <div class="mb-4 sm:mb-6">
            <div class="flex items-center gap-2 mb-2">
                <span class="material-symbols-outlined text-gray-400 text-sm">tag</span>
                <span class="text-sm text-gray-400">Tags:</span>
            </div>
            <div class="flex flex-wrap gap-1.5">
                {% for tag in post.tags %}
                <a href="{{ url_for('tag_posts', slug=tag.slug) }}" 
                   class="bg-gray-700/50 text-gray-300 px-3 py-1 rounded-full text-sm hover:bg-gray-600/50 hover:text-white transition-all duration-200 border border-gray-600/50 hover:border-gray-500">
                    {{ tag.name }}
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </header>

    <!-- Post Content -->
    <div class="prose prose-sm sm:prose-base lg:prose-lg max-w-none mb-8 sm:mb-12 dark:prose-invert light:prose-slate">
        <!-- Split content for mid-article ad -->
        {% set content_parts = post.html_content.split('</p>') %}
        {% set mid_point = (content_parts|length / 2)|int %}
        
        <!-- First half of content -->
        {% for part in content_parts[:mid_point] %}
        {{ part|safe }}{% if not loop.last %}</p>{% endif %}
        {% endfor %}
        
        <!-- Mid-Article Ad -->
        {% if ads_content and content_parts|length > 4 %}
        <div class="not-prose my-8 text-center">
        <div class="bg-gray-800/30 border border-gray-700/30 rounded-lg p-4 overflow-hidden dark:bg-gray-800/30 light:bg-gray-100/30 light:border-gray-300/30">
        <div class="text-xs text-gray-500 mb-2">Advertisement</div>
        {{ ads_content|safe }}
        </div>
        </div>
        {% endif %}
        
        <!-- Second half of content -->
        {% for part in content_parts[mid_point:] %}
        {{ part|safe }}{% if not loop.last %}</p>{% endif %}
        {% endfor %}
    </div>

    <!-- Pre-Comments Ad -->
    {% if ads_content %}
    <div class="mb-8 text-center">
    <div class="bg-gray-800/30 border border-gray-700/30 rounded-lg p-4 overflow-hidden dark:bg-gray-800/30 light:bg-gray-100/30 light:border-gray-300/30">
    <div class="text-xs text-gray-500 mb-2">Advertisement</div>
    {{ ads_content|safe }}
    </div>
    </div>
    {% endif %}
    
    <!-- Comments Section -->
    <div class="border-t border-gray-700/50 pt-8 mb-8">
        <h3 class="text-2xl font-bold text-white mb-6">Comments ({{ post.approved_comments|length }})</h3>
        
        <!-- Existing Comments -->
        {% if post.approved_comments %}
        <div class="space-y-6 mb-8">
            {% for comment in post.approved_comments %}
            <div class="bg-gray-800 rounded-lg p-6">
                <div class="flex items-center mb-3">
                    <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold mr-3">
                        {{ comment.name[0].upper() }}
                    </div>
                    <div>
                        <h4 class="font-semibold text-white">{{ comment.name }}</h4>
                        <p class="text-sm text-gray-400">{{ comment.created_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
                    </div>
                </div>
                <p class="text-gray-300 leading-relaxed">{{ comment.content }}</p>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- Comment Form -->
        <div class="bg-gray-800 border border-gray-700 rounded-lg p-6">
            <h4 class="text-lg font-semibold text-white mb-4">Leave a Comment</h4>
            <form method="POST" class="space-y-4">
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-300 mb-1">Name *</label>
                        <input type="text" id="name" name="name" required 
                               class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-300 mb-1">Email *</label>
                        <input type="email" id="email" name="email" required 
                               class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                <div>
                    <label for="content" class="block text-sm font-medium text-gray-300 mb-1">Comment *</label>
                    <textarea id="content" name="content" rows="4" required 
                              class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                              placeholder="Share your thoughts..."></textarea>
                </div>
                <button type="submit" 
                        class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    <span class="material-symbols-outlined mr-2 text-sm">comment</span>Post Comment
                </button>
                <p class="text-sm text-gray-400">Your comment will be reviewed before being published.</p>
            </form>
        </div>
    </div>

    <!-- Share Buttons -->
    <div class="border-t border-gray-700/50 pt-8 mb-8">
        <h3 class="text-lg font-semibold text-white mb-4">Share this post</h3>
        <div class="flex flex-wrap gap-2 sm:gap-4">
            <a href="https://twitter.com/intent/tweet?text={{ post.title }}&url={{ request.url }}" 
               target="_blank"
               class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                <span class="material-symbols-outlined mr-2 text-sm">share</span>Twitter
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.url }}" 
               target="_blank"
               class="bg-blue-700 text-white px-4 py-2 rounded-lg hover:bg-blue-800 transition-colors">
                <span class="material-symbols-outlined mr-2 text-sm">share</span>Facebook
            </a>
            <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.url }}" 
               target="_blank"
               class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                <span class="material-symbols-outlined mr-2 text-sm">share</span>LinkedIn
            </a>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="border-t border-gray-700/50 pt-8">
        <div class="flex flex-col sm:flex-row justify-between gap-4 sm:gap-0">
            <a href="{{ url_for('index') }}" 
               class="bg-gray-800 text-gray-300 px-6 py-3 rounded-lg hover:bg-gray-700 transition-colors">
                <span class="material-symbols-outlined mr-2 text-sm">arrow_back</span>Back to Posts
            </a>
            {% if post.category %}
            <a href="{{ url_for('category_posts', slug=post.category.slug) }}" 
               class="bg-blue-600/20 text-blue-400 px-6 py-3 rounded-lg hover:bg-blue-600/30 transition-colors">
                More in {{ post.category.name }} <span class="material-symbols-outlined ml-2 text-sm">arrow_forward</span>
            </a>
            {% endif %}
        </div>
    </nav>
</article>

<!-- Sidebar Ad (Desktop) -->
<aside class="hidden lg:block fixed right-4 top-1/2 transform -translate-y-1/2 w-48 z-30">
{% if ads_sidebar %}
<div class="bg-gray-800/50 border border-gray-700/50 rounded-lg p-3 mb-4 overflow-hidden dark:bg-gray-800/50 light:bg-gray-100/50 light:border-gray-300/50">
<div class="text-xs text-gray-500 mb-2 text-center">Advertisement</div>
{{ ads_sidebar|safe }}
</div>
{% endif %}
</aside>

<!-- Bottom Content Ad -->
{% if ads_footer %}
<div class="mx-auto max-w-4xl px-4 py-6 text-center">
<div class="bg-gray-800/50 border border-gray-700/50 rounded-lg p-4 overflow-hidden dark:bg-gray-800/50 light:bg-gray-100/50 light:border-gray-300/50">
{{ ads_footer|safe }}
</div>
</div>
{% endif %}

<!-- JSON-LD Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "{{ post.title }}",
  "description": "{{ post.excerpt or post.content[:160] }}",
  "datePublished": "{{ post.created_at.isoformat() }}",
  "dateModified": "{{ post.updated_at.isoformat() }}",
  {% if post.cover_image %}
  "image": "{{ url_for('static', filename='uploads/' + post.cover_image, _external=True) }}",
  {% endif %}
  "author": {
    "@type": "Organization",
    "name": "ModernBlog"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ site_name or 'ModernBlog' }}"
  }
}
</script>

<!-- Responsive Ad CSS -->
<style>
/* Responsive Ad Containers */
.ad-container {
    max-width: 100%;
    overflow: hidden;
}

/* Google AdSense Responsive */
.adsbygoogle {
    display: block;
    width: 100%;
}

/* Mobile Ad Adjustments */
@media (max-width: 768px) {
    aside {
        display: none !important;
    }
    .ad-container {
        margin: 1rem 0;
    }
}

/* Desktop Sidebar Ad */
@media (min-width: 1024px) {
    .sidebar-ad {
        position: sticky;
        top: 50%;
        transform: translateY(-50%);
    }
}

/* Ad spacing */
.ad-spacing {
    margin: 2rem 0;
}

/* Light theme ad containers */
.light .ad-container {
    background-color: rgba(248, 250, 252, 0.5);
    border-color: rgba(203, 213, 225, 0.5);
}
</style>
{% endblock %}