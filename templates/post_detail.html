{% extends "base.html" %}

{% block title %}{{ post.title }} - {{ site_name or 'ModernBlog' }}{% endblock %}
{% block description %}{{ post.excerpt or post.content[:160] }}{% endblock %}
{% block keywords %}{{ post.tags|map(attribute='name')|join(', ') }}{% endblock %}

{% block og_title %}{{ post.title }}{% endblock %}
{% block og_description %}{{ post.excerpt or post.content[:160] }}{% endblock %}
{% block og_type %}article{% endblock %}
{% block og_image %}
{% if post.cover_image %}
<meta property="og:image" content="{{ url_for('static', filename='uploads/' + post.cover_image, _external=True) }}">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
{% endif %}
{% endblock %}

{% block twitter_image %}
{% if post.cover_image %}
<meta name="twitter:image" content="{{ url_for('static', filename='uploads/' + post.cover_image, _external=True) }}">
{% endif %}
{% endblock %}

{% block content %}
<article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8">
    <!-- Breadcrumb -->
    <nav class="mb-8">
        <ol class="flex items-center space-x-2 text-sm text-gray-500">
            <li><a href="{{ url_for('index') }}" class="hover:text-blue-600">Home</a></li>
            <li><i class="fas fa-chevron-right text-xs"></i></li>
            {% if post.category %}
            <li><a href="{{ url_for('category_posts', slug=post.category.slug) }}" class="hover:text-blue-600">{{ post.category.name }}</a></li>
            <li><i class="fas fa-chevron-right text-xs"></i></li>
            {% endif %}
            <li class="text-gray-800">{{ post.title }}</li>
        </ol>
    </nav>

    <!-- Cover Image -->
    {% if post.cover_image %}
    <div class="mb-6 sm:mb-8 rounded-xl overflow-hidden shadow-lg">
        <img src="{{ url_for('static', filename='uploads/' + post.cover_image) }}" 
             alt="{{ post.title }}" 
             class="w-full h-48 sm:h-64 md:h-80 lg:h-96 object-cover">
    </div>
    {% endif %}

    <!-- Post Header -->
    <header class="mb-8">
        {% if post.category %}
        <span class="inline-block bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded-full mb-4">
            {{ post.category.name }}
        </span>
        {% endif %}
        
        <h1 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-gray-800 mb-4 leading-tight">{{ post.title }}</h1>
        
        {% if post.excerpt %}
        <p class="text-lg sm:text-xl text-gray-600 mb-4 sm:mb-6">{{ post.excerpt }}</p>
        {% endif %}
        
        <div class="flex flex-col sm:flex-row sm:items-center text-gray-500 mb-4 sm:mb-6 gap-2 sm:gap-0">
            <i class="fas fa-calendar mr-2"></i>
            <time datetime="{{ post.created_at.isoformat() }}">{{ post.created_at.strftime('%B %d, %Y') }}</time>
            {% if post.updated_at != post.created_at %}
            <span class="mx-2">â€¢</span>
            <i class="fas fa-edit mr-2"></i>
            <span>Updated {{ post.updated_at.strftime('%B %d, %Y') }}</span>
            {% endif %}
        </div>
        
        {% if post.tags %}
        <div class="flex flex-wrap gap-1 sm:gap-2 mb-4 sm:mb-6">
            {% for tag in post.tags %}
            <a href="{{ url_for('tag_posts', slug=tag.slug) }}" 
               class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm hover:bg-gray-200 transition-colors">
                #{{ tag.name }}
            </a>
            {% endfor %}
        </div>
        {% endif %}
    </header>

    <!-- Post Content -->
    <div class="prose prose-sm sm:prose-base lg:prose-lg max-w-none mb-8 sm:mb-12">
        {{ post.html_content|safe }}
    </div>

    <!-- Comments Section -->
    <div class="border-t border-gray-200 pt-8 mb-8">
        <h3 class="text-2xl font-bold text-gray-800 mb-6">Comments ({{ post.approved_comments|length }})</h3>
        
        <!-- Existing Comments -->
        {% if post.approved_comments %}
        <div class="space-y-6 mb-8">
            {% for comment in post.approved_comments %}
            <div class="bg-gray-50 rounded-lg p-6">
                <div class="flex items-center mb-3">
                    <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold mr-3">
                        {{ comment.name[0].upper() }}
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800">{{ comment.name }}</h4>
                        <p class="text-sm text-gray-500">{{ comment.created_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
                    </div>
                </div>
                <p class="text-gray-700 leading-relaxed">{{ comment.content }}</p>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- Comment Form -->
        <div class="bg-white border border-gray-200 rounded-lg p-6">
            <h4 class="text-lg font-semibold text-gray-800 mb-4">Leave a Comment</h4>
            <form method="POST" class="space-y-4">
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Name *</label>
                        <input type="text" id="name" name="name" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                        <input type="email" id="email" name="email" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                <div>
                    <label for="content" class="block text-sm font-medium text-gray-700 mb-1">Comment *</label>
                    <textarea id="content" name="content" rows="4" required 
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                              placeholder="Share your thoughts..."></textarea>
                </div>
                <button type="submit" 
                        class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-comment mr-2"></i>Post Comment
                </button>
                <p class="text-sm text-gray-500">Your comment will be reviewed before being published.</p>
            </form>
        </div>
    </div>

    <!-- Share Buttons -->
    <div class="border-t border-gray-200 pt-8 mb-8">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Share this post</h3>
        <div class="flex flex-wrap gap-2 sm:gap-4">
            <a href="https://twitter.com/intent/tweet?text={{ post.title }}&url={{ request.url }}" 
               target="_blank"
               class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                <i class="fab fa-twitter mr-2"></i>Twitter
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.url }}" 
               target="_blank"
               class="bg-blue-700 text-white px-4 py-2 rounded-lg hover:bg-blue-800 transition-colors">
                <i class="fab fa-facebook mr-2"></i>Facebook
            </a>
            <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.url }}" 
               target="_blank"
               class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                <i class="fab fa-linkedin mr-2"></i>LinkedIn
            </a>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="border-t border-gray-200 pt-8">
        <div class="flex flex-col sm:flex-row justify-between gap-4 sm:gap-0">
            <a href="{{ url_for('index') }}" 
               class="bg-gray-100 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-200 transition-colors">
                <i class="fas fa-arrow-left mr-2"></i>Back to Posts
            </a>
            {% if post.category %}
            <a href="{{ url_for('category_posts', slug=post.category.slug) }}" 
               class="bg-blue-100 text-blue-700 px-6 py-3 rounded-lg hover:bg-blue-200 transition-colors">
                More in {{ post.category.name }} <i class="fas fa-arrow-right ml-2"></i>
            </a>
            {% endif %}
        </div>
    </nav>
</article>

<!-- JSON-LD Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "{{ post.title }}",
  "description": "{{ post.excerpt or post.content[:160] }}",
  "datePublished": "{{ post.created_at.isoformat() }}",
  "dateModified": "{{ post.updated_at.isoformat() }}",
  {% if post.cover_image %}
  "image": "{{ url_for('static', filename='uploads/' + post.cover_image, _external=True) }}",
  {% endif %}
  "author": {
    "@type": "Organization",
    "name": "ModernBlog"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ site_name or 'ModernBlog' }}"
  }
}
</script>
{% endblock %}